*****************************************************************************
**                      Tuning and Analysis Utilities                      **
**			http://www.cs.uoregon.edu/research/paracomp/tau    **
*****************************************************************************
**    Copyright 1997-2004                                                  **
**    Department of Computer and Information Science, University of Oregon **
**    Advanced Computing Laboratory, Los Alamos National Laboratory        **
**    Research Center Juelich, ZAM Germany                                 **
*****************************************************************************

*************************************************************************
*			USING TAU WITH MUSE	 	      		*	
* Author	: Suravee Suthikulpanit (suravee@cs.uoregon.edu)	*
* Date		: 2/6/2004						*
* Version	: 1.1							*
* Log Change	:							*
*		- (1) Restructure struct package to be ready for 	*
*		multiple double values, multiple handlers, 		*
* 		multiple filters.					*
*		- Add partial support for (1)				*
* 		- Move package_selector stuff into TauMusePackages.cpp	*
*		- Add API TauMuseCreate ()				*
* 		- Add package context_switch.				*
*		- Add package accumulator_sock_send.			*
*		- Add package accumulator_sock_recv.			*
*		- Add support for new socket_filter.			*
*		- Change encoding for process_scheduling		*
*		- Lengthen size of current_directory to fix a bug.	*
*************************************************************************

MAGNET: 
	MAGNET instruments Linux Kernel with a set of instrumentation points
	"MAGNET_ADD()" which will output records of specific kernel events 
	to userspace by MUSE.

MUSE: MAGNET User-Space Environment.
	MUSE contains the implementation of magnetd and utilities for monitoring
	MAGNET events.  Users can implement a set of "Handlers" and "Filters"
	to analyze event records information received from MAGNET.

	For more information, please refer to http://public.lanl.gov/radiant/

MUSE NOTE:
	- Tested with muse-0.9.0.2-1.

INSTALLATION:

% configure -muse
   
   Specifies the use of MAGNET/MUSE to extract low-level information from the
   kernel. To use this configuration, Linux kernel has to be patched with MAGNET
   and MUSE has to be install on the executing machine.  Also, magnetd has to be
   running with the appropriate handlers and filters installed.

   -muse is used when monotonically increasing data is monitored. "double TauMuseQuery()"
   is automatically called for every entry and exit point of every function in
   a target application.  A monitored double value is returned while -1 is returned
   in case of error.

USAGE:

   TAU provides different packages which are predefined set of MUSE handlers and
   filters with specific arguments.  These packages let TAU users monitor 
   various performance matrices.
   
   The name of the package routine is set by the user using the environment 
   variable TAU_MUSE_PACKAGE. 

   =============================================================================
   LIST OF PACKAGES:
   =============================================================================
   MODE OF OPERATION: -muse (By default, TAU_MUSE_PACKAGE=count)

   1) Package Name:	count
	This package keeps track of number of MAGNET instrumentation points executed
	in the LINUX kernel caused by the profiled program.  These counts are event 
	records according to the specified PID.  
	Handler	:	TAU_count
	Filter	:	process_filter
	Command	:	
	create TAU_count
	addfilter <handlerID> process_filter pid=<pid>
	Usage   : Prior to execution, set enviroment variable MAGNET_MUSE_PACKAGE=TAU_count

   2) Package Name: 	busy_time
  	Total time in millisec of processors in BUSY state doing work 
	for the specified PID.
	Handler :	process_scheduling
	Filter	:	process_filter
	Command	:
	create process_scheduling
	addfilter <handlerID> process_filter pid=<pid> event=258 //MAGNET_TASK_CTX_IN	
	addfilter <handlerID> process_filter pid=<pid> event=259 //MAGNET_TASK_CTX_OUT	
	Usage   : Prior to execution, set enviroment variable MAGNET_MUSE_PACKAGE=busy_time

   3) Package Name: 	idle_time
  	Total time in millisec of processors in Idle state. 
	Handler :	process_scheduling
	Filter	:	process_filter
	Command	:
	create process_scheduling
	addfilter <handlerID> process_filter pid=0 event=258 //MAGNET_TASK_CTX_IN	
	addfilter <handlerID> process_filter pid=0 event=259 //MAGNET_TASK_CTX_OUT	
	Usage   : Prior to execution, set enviroment variable MAGNET_MUSE_PACKAGE=idle_time

   4) Package Name: 	total_time 
  	Total time in millisec of processors in execution for the 
	specified PID. 
	Handler :	process_scheduling
	Filter	:	process_filter
	Command	:
	create process_scheduling
	addfilter <handlerID> process_filter pid=<pid> event=258 //MAGNET_TASK_CTX_IN	
	addfilter <handlerID> process_filter pid=<pid> event=259 //MAGNET_TASK_CTX_OUT	
	Usage   : Prior to execution, set enviroment variable MAGNET_MUSE_PACKAGE=total_time
	
   5) Package Name: 	context_switch
  	Total number of context switches for the specified PID. 
	Handler :	process_scheduling
	Filter	:	process_filter
	Command	:
	create process_scheduling
	addfilter <handlerID> process_filter pid=<pid> event=258 //MAGNET_TASK_CTX_IN	
	addfilter <handlerID> process_filter pid=<pid> event=259 //MAGNET_TASK_CTX_OUT	
	Usage   : Prior to execution, set enviroment variable MAGNET_MUSE_PACKAGE=context_switch

   6) Package Name: 	accumulator_sock_send
  	Total number of bytes sent out on sockets for a specified pid. 
	Handler :	accumulator
	Filter	:	socket_filter
	Command	:
	create process_scheduling
	addfilter <handlerID> socket_filter=<pid> event=3 //MAGNET_SOCK_SEND
	Usage   : Prior to execution, set enviroment variable MAGNET_MUSE_PACKAGE=accumulator_sock_send

   7) Package Name: 	accumulator_sock_recv
  	Total number of bytes received through sockets for a specified pid. 
	Handler :	accumulator
	Filter	:	socket_filter
	Command	:
	create process_scheduling
	addfilter <handlerID> socket_filter=<pid> event=4 //MAGNET_SOCK_RECV
	Usage   : Prior to execution, set enviroment variable MAGNET_MUSE_PACKAGE=accumulator_sock_recv

   ----------------------------------------------------------------------------
 
NOTE: 
	Some configuration should be modified according to machine.
	- MAXNUMOFCPU 		: default to 2. 
	(This can run with Uni-processor and Dual-processor machine.)
	- AF_UNIX_MODE		: is defined by default.
	(This will configure muse to run in AF_INET or AF_UNIX mode. However, AF_INET is not
	recommend since it will significantly impact the performance of profiling.)
 
BUGS:
TODO:
	- Finish up support for Multiple counters/handlers/filters.
	- Merge with MULTIPLECOUNTERS.
