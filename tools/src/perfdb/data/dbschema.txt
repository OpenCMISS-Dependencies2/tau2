CREATE TABLE Applications (
	AppID          SERIAL          NOT NULL    PRIMARY KEY,
	AppName        VARCHAR(100)    NOT NULL,
	Version        VARCHAR(100)    DEFAULT '1.0'        ,
	Description    TEXT            , 
	Language       VARCHAR(100)    NOT NULL,    
	Paradigm       VARCHAR(100)     ,
	Usage          TEXT            ,
	Exe_opt        TEXT            ,	
	Exp_table_name VARCHAR(100)     DEFAULT 'EXPERIMENTS'    
);

CREATE TABLE Experiments (
	ExpID          SERIAL             NOT NULL    PRIMARY KEY,
	AppID          INT             NOT NULL,
	SysInfo        TEXT            DEFAULT 'Sys_Info.xml', 
	ConfigInfo     TEXT            DEFAULT 'Config_Info.xml',
	InstruInfo     TEXT            DEFAULT 'Instru_Info.xml',
	CompilerInfo   TEXT            DEFAULT 'Compiler_Info.xml',
	Trial_table_name VARCHAR(100)   DEFAULT 'TRIALS' ,
	CONSTRAINT efkey FOREIGN KEY(AppID) REFERENCES Applications(AppID) ON DELETE CASCADE ON UPDATE CASCADE
	
);


CREATE TABLE XMLfiles (
	XMLfileID    SERIAL              NOT NULL     PRIMARY KEY,
	XMLfileName  TEXT      NOT NULL
);

CREATE TABLE Trials (
	TrialID         SERIAL             NOT NULL    PRIMARY KEY,
	ExpID           INT                NOT NULL,
	Time            TIMESTAMP WITHOUT TIME ZONE,
	Metric          VARCHAR(50)     , 
	ProblemSize     INT,
	NodeNum         INT,
	ContextPNode    INT,
	ThreadPContext  INT,
	XMLfileID       INT,
	CONSTRAINT tfkey1 FOREIGN KEY(ExpID) REFERENCES Experiments(ExpID) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT tfkey2 FOREIGN KEY(XMLfileID) REFERENCES XMLfiles(XMLfileID) ON DELETE NO ACTION ON UPDATE CASCADE
);


CREATE TABLE FunIndex (
	FunIndexID      SERIAL           NOT NULL    PRIMARY KEY,
	FunID           INT,
	FunName         TEXT		 NOT NULL,
	TrialID         INT              NOT NULL,
	CONSTRAINT ffkey FOREIGN KEY(TrialID) REFERENCES Trials(TrialID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE LocationIndex (
	LocID           SERIAL           NOT NULL    PRIMARY KEY,
	NodeID          INT              NOT NULL,             
	ContextID       INT              NOT NULL,
	ThreadID        INT              NOT NULL,
	FunIndexID      INT              NOT NULL,
	CONSTRAINT lfkey FOREIGN KEY(FunIndexID) REFERENCES FunIndex(FunIndexID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE Pprof (
	LocID           INT              NOT NULL   PRIMARY KEY,
	Inclperc        DECIMAL,
	Incl            DECIMAL,
	Exclperc        DECIMAL,
	Excl            DECIMAL,
	Call            DECIMAL,
	Subrs           DECIMAL,
	InclPCall       DECIMAL,
	CONSTRAINT pfkey FOREIGN KEY(LocID) REFERENCES LocationIndex(LocID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE UserEvent (
        LocID           INT              NOT NULL   PRIMARY KEY,
        NumOfSamples    INT    ,         
	MaxValue        DECIMAL,
	MinValue        DECIMAL,
	MeanValue       DECIMAL,
	CONSTRAINT ufkey FOREIGN KEY(LocID) REFERENCES LocationIndex(LocID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE Totalsummary (
	FunIndexID      INT              NOT NULL   PRIMARY KEY,
	Inclperc        DECIMAL,
	Incl            DECIMAL,
	Exclperc        DECIMAL,
	Excl            DECIMAL,
	Call            DECIMAL,
	Subrs           DECIMAL,
	InclPCall       DECIMAL,
	CONSTRAINT tfkey FOREIGN KEY(FunIndexID) REFERENCES FunIndex(FunIndexID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE Meansummary (
	FunIndexID      INT              NOT NULL   PRIMARY KEY,
	Inclperc        DECIMAL,
	Incl            DECIMAL,
	Exclperc        DECIMAL,
	Excl            DECIMAL,
	Call            DECIMAL,
	Subrs           DECIMAL,
	InclPCall       DECIMAL,
	CONSTRAINT mfkey FOREIGN KEY(FunIndexID) REFERENCES FunIndex(FunIndexID) ON DELETE CASCADE ON UPDATE CASCADE
);

