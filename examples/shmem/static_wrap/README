Static SHMEM API Wrapping Example
=================================

Compiles all program objects as normal (i.e. no instrumentation) then uses
tau_cc.sh to wrap SHMEM API calls at link time.


Profiling
---------

    % export TAU_MAKEFILE=$PWD/../../../x86_64/lib/Makefile.tau-shmem-pdt
    % make profile


Tracing
-------

    To view the trace you'll need to forward your X11 display or copy the
    tau.slog2 file to a local machine where TAU is already installed.

    % export TAU_MAKEFILE=$PWD/../../../x86_64/lib/Makefile.tau-shmem-pdt
    % make trace
    % jumpshot tau.slog2


Example Output
--------------

oshcc -Wall -c rotput.c -o rotput.o
tau_cc.sh -optLinkOnly  rotput.o -o rotput 
Debug: Moving these libraries to the end of the link line:


Debug: Linking with TAU Options
Executing> /usr/local/packages/openshmem/ornl_gasnet-1.26.3_gcc-4.9.3/bin/oshcc rotput.o -o rotput @/home/users/jlinford/workspace/tau2/x86_64/lib/wrappers/shmem/link_options.tau -L/home/users/jlinford/workspace/tau2/x86_64/lib -ltau-shmem-pdt -L/home/users/jlinford/workspace/tau2/x86_64/binutils-2.23.2/lib -L/home/users/jlinford/workspace/tau2/x86_64/binutils-2.23.2/lib64 -Wl,-rpath,/home/users/jlinford/workspace/tau2/x86_64/binutils-2.23.2/lib -Wl,-rpath,/home/users/jlinford/workspace/tau2/x86_64/binutils-2.23.2/lib64 -lbfd -liberty -lz -Wl,--export-dynamic -lrt -L/home/users/jlinford/workspace/tau2/x86_64/libunwind-1.1-oshcc/lib -lunwind -Wl,-rpath,/home/users/jlinford/workspace/tau2/x86_64/libunwind-1.1-oshcc/lib -ldl -lm -L/storage/packages/gcc/4.9.3/bin/../lib/gcc/x86_64-unknown-linux-gnu/4.9.3/ -lstdc++ -lgcc_s -L/home/users/jlinford/workspace/tau2/x86_64/lib -lTauShmem-shmem-pdt -L/usr/local/packages/openshmem/ornl_gasnet-1.26.3_gcc-4.9.3/lib -L/usr/local/packages/openshmem/ornl_gasnet-1.26.3_gcc-4.9.3/lib -lopenshmem -L/home/users/jlinford/workspace/tau2/x86_64/lib/static-shmem-pdt


Debug:
Executing> /usr/local/packages/openshmem/ornl_gasnet-1.26.3_gcc-4.9.3/bin/oshcc rotput.o -o rotput -I/home/users/jlinford/workspace/tau2/include -I/usr/local/packages/openshmem/ornl_gasnet-1.26.3_gcc-4.9.3/include -I/usr/local/packages/openshmem/ornl_gasnet-1.26.3_gcc-4.9.3/include/mpp @/home/users/jlinford/workspace/tau2/x86_64/lib/wrappers/shmem/link_options.tau -L/home/users/jlinford/workspace/tau2/x86_64/lib -ltau-shmem-pdt -L/home/users/jlinford/workspace/tau2/x86_64/binutils-2.23.2/lib -L/home/users/jlinford/workspace/tau2/x86_64/binutils-2.23.2/lib64 -Wl,-rpath,/home/users/jlinford/workspace/tau2/x86_64/binutils-2.23.2/lib -Wl,-rpath,/home/users/jlinford/workspace/tau2/x86_64/binutils-2.23.2/lib64 -lbfd -liberty -lz -Wl,--export-dynamic -lrt -L/home/users/jlinford/workspace/tau2/x86_64/libunwind-1.1-oshcc/lib -lunwind -Wl,-rpath,/home/users/jlinford/workspace/tau2/x86_64/libunwind-1.1-oshcc/lib -ldl -lm -L/storage/packages/gcc/4.9.3/bin/../lib/gcc/x86_64-unknown-linux-gnu/4.9.3/ -lstdc++ -lgcc_s -L/home/users/jlinford/workspace/tau2/x86_64/lib -lTauShmem-shmem-pdt -L/usr/local/packages/openshmem/ornl_gasnet-1.26.3_gcc-4.9.3/lib -L/usr/local/packages/openshmem/ornl_gasnet-1.26.3_gcc-4.9.3/lib -lopenshmem -L/home/users/jlinford/workspace/tau2/x86_64/lib/static-shmem-pdt

oshrun -np 4 ./rotput
   3: got    3: CORRECT
   1: got    1: CORRECT
   2: got    2: CORRECT
   0: got    0: CORRECT
pprof
Reading Profile files in profile.*

NODE 0;CONTEXT 0;THREAD 0:
---------------------------------------------------------------------------------------
%Time    Exclusive    Inclusive       #Call      #Subrs  Inclusive Name
              msec   total msec                          usec/call 
---------------------------------------------------------------------------------------
100.0        0.183            5           1           9       5414 .TAU application
 90.5            4            4           1           0       4900 void shmem_init(void) C
  4.7        0.256        0.256           1           0        256 void shmem_finalize(void) C
  0.9        0.048        0.048           1           0         48 void shmem_int_put(int *, const int *, size_t, int) C
  0.3        0.017        0.017           1           0         17 void shmem_free(void *) C
  0.2        0.009        0.009           3           0          3 void shmem_barrier_all(void) C
  0.0        0.001        0.001           1           0          1 int shmem_my_pe(void) C
  0.0            0            0           1           0          0 int shmem_n_pes(void) C
---------------------------------------------------------------------------------------

USER EVENTS Profile :NODE 0, CONTEXT 0, THREAD 0
---------------------------------------------------------------------------------------
NumSamples   MaxValue   MinValue  MeanValue  Std. Dev.  Event Name
---------------------------------------------------------------------------------------
         1          4          4          4          0  Message size sent to all nodes
---------------------------------------------------------------------------------------

NODE 1;CONTEXT 0;THREAD 0:
---------------------------------------------------------------------------------------
%Time    Exclusive    Inclusive       #Call      #Subrs  Inclusive Name
              msec   total msec                          usec/call 
---------------------------------------------------------------------------------------
100.0        0.582            5           1           9       5258 .TAU application
 85.3            4            4           1           0       4485 void shmem_init(void) C
  1.9        0.101        0.101           1           0        101 void shmem_finalize(void) C
  0.7        0.038        0.038           3           0         13 void shmem_barrier_all(void) C
  0.7        0.035        0.035           1           0         35 void shmem_int_put(int *, const int *, size_t, int) C
  0.3        0.017        0.017           1           0         17 void shmem_free(void *) C
  0.0            0            0           1           0          0 int shmem_my_pe(void) C
  0.0            0            0           1           0          0 int shmem_n_pes(void) C
---------------------------------------------------------------------------------------

USER EVENTS Profile :NODE 1, CONTEXT 0, THREAD 0
---------------------------------------------------------------------------------------
NumSamples   MaxValue   MinValue  MeanValue  Std. Dev.  Event Name
---------------------------------------------------------------------------------------
         1          4          4          4          0  Message size sent to all nodes
---------------------------------------------------------------------------------------

NODE 2;CONTEXT 0;THREAD 0:
---------------------------------------------------------------------------------------
%Time    Exclusive    Inclusive       #Call      #Subrs  Inclusive Name
              msec   total msec                          usec/call 
---------------------------------------------------------------------------------------
100.0         0.19            5           1           9       5281 .TAU application
 92.7            4            4           1           0       4898 void shmem_init(void) C
  2.2        0.116        0.116           1           0        116 void shmem_finalize(void) C
  0.9        0.047        0.047           1           0         47 void shmem_int_put(int *, const int *, size_t, int) C
  0.3        0.018        0.018           1           0         18 void shmem_free(void *) C
  0.2         0.01         0.01           3           0          3 void shmem_barrier_all(void) C
  0.0        0.001        0.001           1           0          1 int shmem_my_pe(void) C
  0.0        0.001        0.001           1           0          1 int shmem_n_pes(void) C
---------------------------------------------------------------------------------------

USER EVENTS Profile :NODE 2, CONTEXT 0, THREAD 0
---------------------------------------------------------------------------------------
NumSamples   MaxValue   MinValue  MeanValue  Std. Dev.  Event Name
---------------------------------------------------------------------------------------
         1          4          4          4          0  Message size sent to all nodes
---------------------------------------------------------------------------------------

NODE 3;CONTEXT 0;THREAD 0:
---------------------------------------------------------------------------------------
%Time    Exclusive    Inclusive       #Call      #Subrs  Inclusive Name
              msec   total msec                          usec/call 
---------------------------------------------------------------------------------------
100.0         0.81            5           1           9       5223 .TAU application
 81.1            4            4           1           0       4235 void shmem_init(void) C
  1.3         0.07         0.07           1           0         70 void shmem_finalize(void) C
  1.1         0.06         0.06           3           0         20 void shmem_barrier_all(void) C
  0.6        0.031        0.031           1           0         31 void shmem_int_put(int *, const int *, size_t, int) C
  0.3        0.017        0.017           1           0         17 void shmem_free(void *) C
  0.0            0            0           1           0          0 int shmem_my_pe(void) C
  0.0            0            0           1           0          0 int shmem_n_pes(void) C
---------------------------------------------------------------------------------------

USER EVENTS Profile :NODE 3, CONTEXT 0, THREAD 0
---------------------------------------------------------------------------------------
NumSamples   MaxValue   MinValue  MeanValue  Std. Dev.  Event Name
---------------------------------------------------------------------------------------
         1          4          4          4          0  Message size sent to all nodes
---------------------------------------------------------------------------------------

FUNCTION SUMMARY (total):
---------------------------------------------------------------------------------------
%Time    Exclusive    Inclusive       #Call      #Subrs  Inclusive Name
              msec   total msec                          usec/call 
---------------------------------------------------------------------------------------
100.0            1           21           4          36       5294 .TAU application
 87.4           18           18           4           0       4630 void shmem_init(void) C
  2.6        0.543        0.543           4           0        136 void shmem_finalize(void) C
  0.8        0.161        0.161           4           0         40 void shmem_int_put(int *, const int *, size_t, int) C
  0.6        0.117        0.117          12           0         10 void shmem_barrier_all(void) C
  0.3        0.069        0.069           4           0         17 void shmem_free(void *) C
  0.0        0.002        0.002           4           0          0 int shmem_my_pe(void) C
  0.0        0.001        0.001           4           0          0 int shmem_n_pes(void) C

FUNCTION SUMMARY (mean):
---------------------------------------------------------------------------------------
%Time    Exclusive    Inclusive       #Call      #Subrs  Inclusive Name
              msec   total msec                          usec/call 
---------------------------------------------------------------------------------------
100.0        0.441            5           1           9       5294 .TAU application
 87.4            4            4           1           0       4630 void shmem_init(void) C
  2.6        0.136        0.136           1           0        136 void shmem_finalize(void) C
  0.8       0.0403       0.0403           1           0         40 void shmem_int_put(int *, const int *, size_t, int) C
  0.6       0.0293       0.0293           3           0         10 void shmem_barrier_all(void) C
  0.3       0.0173       0.0173           1           0         17 void shmem_free(void *) C
  0.0       0.0005       0.0005           1           0          0 int shmem_my_pe(void) C
  0.0      0.00025      0.00025           1           0          0 int shmem_n_pes(void) C
