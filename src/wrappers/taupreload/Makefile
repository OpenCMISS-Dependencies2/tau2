TAUROOT=
include $(TAUROOT)/include/Makefile

#PGI##TAU_PRELOAD_COMPILER_FOR_GNU=$(TAUROOT)/src/wrappers/taupreload/tau_alt_compiler #ENDIF#
#CRAYCNL#TAU_CRAYCNL_TAU_COMPILER_FOR_GNU=$(TAU_PRELOAD_COMPILER_FOR_GNU) #ENDIF#
TAU_CRAYCNL_TAU_COMPILER=$(TAU_CC)
#PGI##TAU_CRAYCNL_TAU_COMPILER= #ENDIF#
TAU_PRELOAD_COMPILER=$(TAU_CC)
#PGI##TAU_PRELOAD_COMPILER=$(TAUROOT)/src/wrappers/taupreload/tau_alt_gnu_compiler gcc #ENDIF#
#CRAYCNL#TAU_PRELOAD_COMPILER=$(TAU_CRAYCNL_TAU_COMPILER_FOR_GNU) $(TAU_CRAYCNL_TAU_COMPILER) #ENDIF#
CC = $(TAU_PRELOAD_COMPILER)
CFLAGS = $(TAU_INCLUDE) $(TAU_DEFS) $(TAU_INTERNAL_FLAGS)
ARFLAGS = rcv

INSTALLDEST = $(TAU_PREFIX_INSTALL_DIR)/$(CONFIG_ARCH)/lib
#LD_AUDITOR_AVAILABLE#TAU_AUDITOR_SHARED=libTAU-dl-auditor$(TAU_SHLIBX) #ENDIF#
#CRAYXMT#TAU_AUDITOR_SHARED= #ENDIF#
#TAU_WINDOWS#TAU_AUDITOR_SHARED= #ENDIF#
#BGL#TAU_AUDITOR_SHARED= #ENDIF#
#CATAMOUNT#TAU_AUDITOR_SHARED= #ENDIF#
#CRAYX1CC#TAU_AUDITOR_SHARED= #ENDIF#
#SUNCC#TAU_AUDITOR_SHARED= #ENDIF#
#APPLEPGI#TAU_AUDITOR_SHARED= #ENDIF#
#HITACHI#TAU_AUDITOR_SHARED= #ENDIF#
#CRAYXMT#TAU_AUDITOR_SHARED= #ENDIF#
#CRAYCC#TAU_AUDITOR_SHARED= #ENDIF#
#USE_NECCXX#TAU_AUDITOR_SHARED= #ENDIF#
#NOSHARED#TAU_AUDITOR_SHARED= #ENDIF#

TAU_PRELOAD_SHARED=libTAU-preload$(TAU_SHLIBX)
#CRAYXMT#TAU_PRELOAD_SHARED= #ENDIF#
#TAU_WINDOWS#TAU_PRELOAD_SHARED= #ENDIF#
#BGL#TAU_PRELOAD_SHARED= #ENDIF#
#CATAMOUNT#TAU_PRELOAD_SHARED= #ENDIF#
#CRAYX1CC#TAU_PRELOAD_SHARED= #ENDIF#
#SUNCC#TAU_PRELOAD_SHARED= #ENDIF#
#APPLEPGI#TAU_PRELOAD_SHARED= #ENDIF#
#HITACHI#TAU_PRELOAD_SHARED= #ENDIF#
#CRAYXMT#TAU_PRELOAD_SHARED= #ENDIF#
#CRAYCC#TAU_PRELOAD_SHARED= #ENDIF#
#USE_NECCXX#TAU_PRELOAD_SHARED= #ENDIF#
#NOSHARED#TAU_PRELOAD_SHARED= #ENDIF#

#LD_AUDITOR_AVAILABLE#TAU_AUDITOR_INSTALL_CMD=cp $(TAU_AUDITOR_SHARED) $(INSTALLDEST)/shared$(TAU_CONFIG) #ENDIF#
#CRAYXMT#TAU_AUDITOR_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#BGL#TAU_AUDITOR_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#CATAMOUNT#TAU_AUDITOR_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#CRAYX1CC#TAU_AUDITOR_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#SUNCC#TAU_AUDITOR_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#APPLEPGI#TAU_AUDITOR_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#HITACHI#TAU_AUDITOR_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#CRAYXMT#TAU_AUDITOR_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#CRAYCC#TAU_AUDITOR_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#USE_NECCXX#TAU_AUDITOR_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#NOSHARED#TAU_AUDITOR_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#TAU_WINDOWS#TAU_AUDITOR_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#

TAU_PRELOAD_INSTALL_CMD=cp $(TAU_PRELOAD_SHARED) $(INSTALLDEST)/shared$(TAU_CONFIG)
#CRAYXMT#TAU_PRELOAD_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#BGL#TAU_PRELOAD_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#CATAMOUNT#TAU_PRELOAD_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#CRAYX1CC#TAU_PRELOAD_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#SUNCC#TAU_PRELOAD_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#APPLEPGI#TAU_PRELOAD_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#HITACHI#TAU_PRELOAD_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#CRAYXMT#TAU_PRELOAD_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#CRAYCC#TAU_PRELOAD_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#USE_NECCXX#TAU_PRELOAD_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#NOSHARED#TAU_PRELOAD_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#
#TAU_WINDOWS#TAU_PRELOAD_INSTALL_CMD=@echo "NOTE: Not building TAU's preload DSO" #ENDIF#

install:$(TAU_PRELOAD_SHARED) $(TAU_AUDITOR_SHARED)
	$(TAU_PRELOAD_INSTALL_CMD) 
	$(TAU_AUDITOR_INSTALL_CMD) 

taupreload.o: taupreload.c
	$(CC) $(CFLAGS) -c taupreload.c

libTAU-preload$(TAU_SHLIBX): taupreload.o
	$(CC) $(TAU_SHFLAGS) libTAU-preload$(TAU_SHLIBX) taupreload.o $(TAU_SHAREDLIBS) $(TAU_LIBDL)

dl_auditor.o: dl_auditor.c
	$(CC) $(CFLAGS) -c dl_auditor.c

libTAU-dl-auditor$(TAU_SHLIBX): dl_auditor.o
	$(CC) -lc -ldl $(TAU_SHFLAGS) libTAU-dl-auditor$(TAU_SHLIBX) dl_auditor.o -ldl

clean:
	/bin/rm -f taupreload.o libTAU-preload$(TAU_SHLIBX) dl_auditor.o libTAU-dl-auditor$(TAU_SHLIBX)

