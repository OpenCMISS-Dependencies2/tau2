TAUROOT=
include $(TAUROOT)/include/Makefile

CC=$(TAU_CC) 
CFLAGS=$(TAU_DEFS) $(TAU_INTERNAL_FLAG1) $(TAU_INCLUDE) -I. -fpermissive

INSTALLDEST = $(TAU_PREFIX_INSTALL_DIR)/$(CONFIG_ARCH)/lib
#CUDA#TAU_CUDA_SHARED=libTAU-CUDA$(TAU_SHLIBX) #ENDIF#
#CUDA#TAU_CUDART_SHARED=libTAU-CUDArt$(TAU_SHLIBX) #ENDIF#
#NOSHARED#TAU_CUDA_SHARED= #ENDIF#
#NOSHARED#TAU_CUDART_SHARED= #ENDIF#

TAU_CUDA_INSTALL_CMD=@echo "NOTE: Not building TAU's CUDA DSO" 
#CUDA#TAU_CUDA_INSTALL_CMD=cp $(TAU_CUDA_SHARED) $(TAU_CUDART_SHARED) $(INSTALLDEST)/shared$(TAU_CONFIG) #ENDIF#
#NOSHARED#TAU_CUDA_INSTALL_CMD=@echo "NOTE: Not building TAU's CUDA DSO" #ENDIF#

install: $(TAU_CUDA_SHARED) $(TAU_CUDART_SHARED)
	$(TAU_CUDA_INSTALL_CMD) 

$(TAU_CUDART_SHARED): cudart_wrap.o 
	$(TAU_CUDA_CXX) -g $(TAU_SHFLAGS) $@ $< $(TAU_SHLIBS) -ldl -L$(INSTALLDEST)/shared

cudart_wrap.o: cudart_wrap.cpp
	$(TAU_CUDA_CXX) -g $(TAU_INTERNAL_FLAGS) $(CFLAGS) -I$(TAU_CUDA_INC) -c $< -o $@

$(TAU_CUDA_SHARED): cuda_wrap.o
	$(TAU_CUDA_CXX) -g $(TAU_SHFLAGS) $@ $< $(TAU_SHLIBS) -ldl -L$(INSTALLDEST)/shared

cuda_wrap.o: cuda_wrap.c
	$(TAU_CUDA_CXX) -g $(TAU_INTERNAL_FLAGS) $(CFLAGS) -I$(TAU_CUDA_INC) -c $< -o $@
clean:
	/bin/rm -f cudart_wrap.o libTAU_CUDArt.so

