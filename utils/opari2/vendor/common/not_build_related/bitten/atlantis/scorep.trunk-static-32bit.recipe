<build xmlns:python="http://bitten.edgewall.org/tools/python"
       xmlns:svn="http://bitten.edgewall.org/tools/svn"
       xmlns:sh="http://bitten.edgewall.org/tools/sh"
       xmlns:c="http://bitten.edgewall.org/tools/c">

  <step id="clean install dir" description="Clean installation directory">
    <sh:exec executable="rm" args="-rf /opt/packages/scorep-static/latest-${scorep.compiler}-${scorep.mpi}" />
  </step>

  <step id="checkout" description="Checkout source from repository">
    <svn:checkout url="https://silc.zih.tu-dresden.de/svn/silc-root" path="${scorep.path}" revision="${revision}" />
  </step>

  <step id="boostrap" description="Bootstrap the project">
    <sh:exec executable="./bootstrap" />
  </step>

  <step id="configure" description="Configure the project">
    <sh:exec executable="./configure" args="--prefix=/opt/packages/scorep-static/latest-${scorep.compiler}-${scorep.mpi} --enable-static --disable-shared --with-nocross-compiler-suite=${scorep.compiler} --with-mpi=${scorep.mpi} --enable-backend-test-runs" />
  </step>

  <step id="bitten environment" description="Make bitten-print-environment">
    <c:make target="bitten-print-environment" />
  </step>

  <step id="make" description="Make all">
    <c:make target="all" />
  </step>

  <step id="make check" description="Make check">
    <sh:exec executable="make" args="check mpi_num_processes=4 mpi_omp_num_threads=2 mpi_omp_num_processes=3" />
  </step>

  <step id="make install" description="Make install">
    <c:make target="install" />
  </step>

  <step id="make installcheck" description="Make installcheck">
    <c:make target="installcheck" />
  </step>

</build>
